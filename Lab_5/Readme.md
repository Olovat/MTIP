
- Стрибог (Streebog, GOST R 34.11-2012) — криптографическая хеш‑функция.
- GOST R 34.10 — схема электронной подписи ( в `gost3410.go`).

Ниже приведено подробное описание каждого алгоритма и порядок их применения.

**Streebog (GOST R 34.11-2012)**

- Назначение: вычисление криптографического хеша сообщения (контрольной суммы с криптографическими свойствами).
- Параметры:
  - Размер блока: 512 бит (64 байта).
  - Поддерживаемые размеры выхода: 256 бит (32 байта) и 512 бит (64 байта).

Алгоритм (вкратце и пошагово):

1. Подготовка сообщения:
   - Сообщение дополняется по правилам спецификации так, чтобы его длина стала кратной 512 бит.
   - В процессе также поддерживается суммарная длина обработанных бит и накопительная сумма всех блоков (переменная `sum`).

2. Инициализация состояния:
   - Инициализируется вектор состояния `h` (512 бит). Для варианта 512-битного хеша начальное `h` обычно равно нулю; для 256-битного — другое фиксированное значение (см. спецификацию).
   - Наличие дополнительных параметров: счетчик обработанных бит `N` и накопительная сумма `sum`.

3. Обработка блоков (циклическая сжатая функция):
   - Для каждого 512-битного блока M вызывается компрессионная функция `g(h, N, M)`, которая включает следующие слои:
     1. X = h XOR M
     2. Подстановка байтов через S‑блок (S-перестановки — нелинейное преобразование).
     3. Перестановка байтов (P‑перемешивание).
     4. Линейное преобразование L (полевая/матричная трансформация над байтами), дающее диффузию.
     5. Наложение раундовых констант и несколько итераций описанных шагов по спецификации.
   - После выполнения компрессии обновляются `h`, `N` (увеличивается на длину обработанного блока в битах) и `sum` (сложение блоков по модулю 2^512).

4. Финализация:
   - После обработки всех блоков выполняются дополнительные две стадии обработки: сначала блок, содержащий `N` (общая длина), затем блок `sum`.
   - По завершении возвращается либо весь вектор `h` (512 бит), либо сокращённый вариант 256 бит, взятый из `h` по спецификации.

Особенности реализации:
- Используются предопределённые S‑блоки, матрицы/константы, и набор фиксированных раундов, как в стандарте.
- Алгоритм детерминированный, стойкий к коллизиям и устойчивый к предобразу при корректной реализации.


**GOST R 34.10 (электронная подпись)**

Это семейство алгоритмов создания и проверки электронной подписи. Часто используется совместно с хеш‑функцией Streebog для получения первичного дайджеста сообщения.

Краткая схема работы (общая идея):

1. Генерация ключей:
   - Выбирается секретный ключ `d` в диапазоне [1, q-1].
   - Вычисляется открытый ключ `Q = d * G`, где `G` — базовая точка на кривой (или другой задаваемой структуре), q — порядок.

2. Подписание сообщения:
   - Вычисляется хеш сообщения: `e = Streebog(message)`; при необходимости `e` преобразуется в целое mod q.
   - Генерируется случайное число `k` (криптографически стойкое) в диапазоне [1, q-1].
   - Вычисляется вспомогательная точка `C = k * G`; берётся её координата `x` и вычисляется `r = x mod q`.
   - Вычисляется `s` по формуле, определённой в реализации (см. код); итоговая подпись — пара `(r, s)`.

3. Проверка подписи:
   - Вычисляется `e = Streebog(message)` и приводится к нужному виду.
   - На основе `r`, `s` и открытого ключа `Q` выполняются проверки, возвращающие true/false.

**Краткая справка — ГОСТ Р 34.10-2018**

Стандарт описывает схему электронной цифровой подписи на эллиптических кривых над GF(p). В версии 2018 года исключён 256‑битный вариант: применяется только 512‑битная кривая.

Хэш‑функция: `ГОСТ Р 34.11-2012` (Стрибог‑512).

Параметры схемы (раздел 5.2):
- `p` — простое число (модуль поля);
- `q` — порядок подгруппы (приближённо 512 бит, 2^508 < q < 2^512);
- `G(x_G, y_G)` — генератор подгруппы, `q·G = O`;
- `a`, `b` — коэффициенты кривой y² ≡ x³ + a·x + b (mod p).

Алгоритм формирования подписи (Алгоритм I):
1. Вычислить `H = Streebog-512(M)` — хеш сообщения `M`.
2. `e = H mod q`; если `e = 0`, то `e := 1`.
3. Выбрать случайное `k ∈ (0, q)`.
4. `C = k·G`; `r = x_C mod q`; если `r = 0`, вернуться к шагу 3.
5. `s = (r·d + k·e) mod q`; если `s = 0`, вернуться к шагу 3.
6. Подпись: пара `(r, s)`.

Алгоритм проверки подписи (Алгоритм II):
1. Проверить, что `0 < r < q` и `0 < s < q`.
2. Вычислить `H = Streebog-512(M)`; `e = H mod q`; если `e = 0`, то `e := 1`.
3. `v = e⁻¹ mod q`.
4. `z1 = s·v mod q`; `z2 = −r·v mod q`.
5. `C = z1·G + z2·Q`; `R = x_C mod q`.
6. Подпись верна тогда и только тогда, когда `R = r`.

Ссылки: RFC 7091, RFC 6986, RFC 9215.
