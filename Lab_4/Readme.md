
## Алгоритм RSA

### Математическая основа

RSA опирается на вычислительную сложность факторизации большого составного числа $N = p \cdot q$.

### Генерация ключей

1. Выбрать два различных простых числа $p$ и $q$ (по $\text{bits}/2$ каждое).
2. Вычислить модуль: $N = p \cdot q$
3. Вычислить функцию Эйлера: $\varphi(N) = (p-1)(q-1)$
4. Выбрать открытый показатель $e$ такой, что $1 < e < \varphi(N)$ и $\gcd(e,\,\varphi(N)) = 1$.  
   В реализации используется стандартное значение $e = 65537$.
5. Найти закрытый показатель $d$: $d = e^{-1} \pmod{\varphi(N)}$ (алгоритм Евклида).

| Ключ | Состав | Публичность |
|------|--------|-------------|
| Открытый | $(e,\; N)$ | передаётся получателю |
| Закрытый | $(d,\; N)$ | хранится в тайне |

### Шифрование числа

$$c = m^e \bmod N, \quad 0 \le m < N$$

### Дешифрование числа

$$m = c^d \bmod N$$

Корректность следует из теоремы Эйлера: $m^{e \cdot d} \equiv m \pmod{N}$.

### Блочное шифрование произвольного текста

Так как RSA работает только с числами $m < N$, текст разбивается на блоки:

1. К данным приписываются 4 байта длины (big-endian): `[len₃ len₂ len₁ len₀ | данные]`.
2. Полученная последовательность разбивается на блоки по $\lfloor(\text{bitlen}(N)-1)/8\rfloor$ байт — это гарантирует $m < N$.
3. Каждый блок интерпретируется как целое число и шифруется формулой $c = m^e \bmod N$.
4. Зашифрованные блоки выводятся в hex через разделитель `:`.

Дешифрование выполняется в обратном порядке, длина из первых 4 байт позволяет точно обрезать дополнение.

---

## Электронная цифровая подпись RSA

### Формирование подписи (закрытый ключ)

1. Вычислить хэш сообщения: $h = \text{SHA-256}(M)$, представить как целое число $H$.
2. Если $H \ge N$ (возможно при малых ключах): $H \leftarrow (H \bmod (N-1)) + 1$.
3. Вычислить подпись: $S = H^d \bmod N$.

### Проверка подписи (открытый ключ)

1. Вычислить $h = \text{SHA-256}(M)$, представить как $H$ (с той же нормировкой).
2. Восстановить хэш из подписи: $H' = S^e \bmod N$.
3. Подпись **верна**, если $H = H'$.

### Свойства ЭЦП RSA

| Свойство | Обеспечение |
|----------|-------------|
| Аутентификация | Подпись можно создать только зная $d$ |
| Целостность | Изменение $M$ изменяет $H$, что нарушает равенство $H = H'$ |
| Невозможность отказа | Только владелец $d$ мог создать подпись, верифицируемую $e$ |
